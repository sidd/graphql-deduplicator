{"version":3,"sources":["../src/deflate.js"],"names":["deflate","node","index","path","id","__typename","route","join","result","fieldNames","Object","keys","Array","isArray","from","length","el","i","fieldName","value","map","childNode","concat","response"],"mappings":";;;;;;;AAEA;AACA,MAAMA,UAAU,CAACC,IAAD,EAAeC,KAAf,EAA8BC,IAA9B,KAA+D;AAC7E,MAAIF,QAAQA,KAAKG,EAAb,IAAmBH,KAAKI,UAA5B,EAAwC;AACtC,UAAMC,QAAQH,KAAKI,IAAL,CAAU,GAAV,CAAd;;AAEA,QAAIL,MAAMI,KAAN,KAAgBJ,MAAMI,KAAN,EAAaL,KAAKI,UAAlB,CAAhB,IAAiDH,MAAMI,KAAN,EAAaL,KAAKI,UAAlB,EAA8BJ,KAAKG,EAAnC,CAArD,EAA6F;AAC3F,aAAO;AACL;AACAC,oBAAYJ,KAAKI,UAFZ;AAGLD,YAAIH,KAAKG;AAHJ,OAAP;AAKD,KAND,MAMO;AACL,UAAI,CAACF,MAAMI,KAAN,CAAL,EAAmB;AACjBJ,cAAMI,KAAN,IAAe,EAAf;AACD;;AAED,UAAI,CAACJ,MAAMI,KAAN,EAAaL,KAAKI,UAAlB,CAAL,EAAoC;AAClCH,cAAMI,KAAN,EAAaL,KAAKI,UAAlB,IAAgC,EAAhC;AACD;;AAEDH,YAAMI,KAAN,EAAaL,KAAKI,UAAlB,EAA8BJ,KAAKG,EAAnC,IAAyC,IAAzC;AACD;AACF;;AAED,MAAII,SAAS,EAAb;AACA,MAAIC,aAAaC,OAAOC,IAAP,CAAYV,IAAZ,CAAjB;AACA,MAAIW,MAAMC,OAAN,CAAcZ,IAAd,CAAJ,EAAyB;AACvBO,aAAS,EAAT;AACAC,iBAAaG,MAAME,IAAN,CAAW,EAAEC,QAAQd,KAAKc,MAAf,EAAX,EAAoC,CAACC,EAAD,EAAKC,CAAL,KAAWA,CAA/C,CAAb;AACD;;AAED,OAAK,MAAMC,SAAX,IAAwBT,UAAxB,EAAoC;AAClC,UAAMU,QAAQlB,KAAKiB,SAAL,CAAd;;AAEA,QAAIN,MAAMC,OAAN,CAAcM,KAAd,CAAJ,EAA0B;AACxBX,aAAOU,SAAP,IAAoBC,MAAMC,GAAN,CAAWC,SAAD,IAAe;AAC3C,YAAK,OAAOA,SAAP,KAAqB,QAArB,IAAiCA,cAAc,IAAhD,IAAyDT,MAAMC,OAAN,CAAcQ,SAAd,CAA7D,EAAuF;AACrF,iBAAOrB,QAAQqB,SAAR,EAAmBnB,KAAnB,EAA0BC,KAAKmB,MAAL,CAAY,CAACJ,SAAD,CAAZ,CAA1B,CAAP;AACD;;AAED,eAAOG,SAAP;AACD,OANmB,CAApB;AAOD,KARD,MAQO,IAAI,OAAOF,KAAP,KAAiB,QAAjB,IAA6BA,UAAU,IAA3C,EAAiD;AACtDX,aAAOU,SAAP,IAAoBlB,QAAQmB,KAAR,EAAejB,KAAf,EAAsBC,KAAKmB,MAAL,CAAY,CAACJ,SAAD,CAAZ,CAAtB,CAApB;AACD,KAFM,MAEA;AACLV,aAAOU,SAAP,IAAoBC,KAApB;AACD;AACF;;AAED,SAAOX,MAAP;AACD,CAjDD;;kBAmDgBe,QAAD,IAAsB;AACnC,QAAMrB,QAAQ,EAAd;;AAEA,SAAOF,QAAQuB,QAAR,EAAkBrB,KAAlB,EAAyB,EAAzB,CAAP;AACD,C","file":"deflate.js","sourcesContent":["// @flow\n\n// eslint-disable-next-line complexity\nconst deflate = (node: Object, index: Object, path: $ReadOnlyArray<string>) => {\n  if (node && node.id && node.__typename) {\n    const route = path.join(',');\n\n    if (index[route] && index[route][node.__typename] && index[route][node.__typename][node.id]) {\n      return {\n        // eslint-disable-next-line id-match\n        __typename: node.__typename,\n        id: node.id\n      };\n    } else {\n      if (!index[route]) {\n        index[route] = {};\n      }\n\n      if (!index[route][node.__typename]) {\n        index[route][node.__typename] = {};\n      }\n\n      index[route][node.__typename][node.id] = true;\n    }\n  }\n\n  let result = {};\n  let fieldNames = Object.keys(node);\n  if (Array.isArray(node)) {\n    result = [];\n    fieldNames = Array.from({ length: node.length }, (el, i) => i);\n  }\n\n  for (const fieldName of fieldNames) {\n    const value = node[fieldName];\n\n    if (Array.isArray(value)) {\n      result[fieldName] = value.map((childNode) => {\n        if ((typeof childNode === 'object' && childNode !== null) || Array.isArray(childNode)) {\n          return deflate(childNode, index, path.concat([fieldName]));\n        }\n\n        return childNode;\n      });\n    } else if (typeof value === 'object' && value !== null) {\n      result[fieldName] = deflate(value, index, path.concat([fieldName]));\n    } else {\n      result[fieldName] = value;\n    }\n  }\n\n  return result;\n};\n\nexport default (response: Object) => {\n  const index = {};\n\n  return deflate(response, index, []);\n};\n"]}